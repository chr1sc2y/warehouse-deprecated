---
title: "计算机网络 应用层"
date: 2015-07-05T08:57:52+10:00
draft: true
categories: ["Computer Science"]
---

# 计算机网络

## 应用层

| 应用层协议 | 端口号 | 传输层协议 | 备注 |
|---|---|---|---|
| DNS | 53 | UDP/TCP | 长度超过 512 字节时使用 TCP |
| DHCP | 67/68 | UDP |   |
| SNMP | 161/162 | UDP |   |
| FTP | 20/21 | TCP | 控制连接 21，数据连接主动模式 20 |
| TELNET | 23 | TCP | |
| HTTP | 80 | TCP | |
| SMTP | 25 | TCP | |
| POP3 | 110 | TCP | |
| IMAP | 143 |TCP | |

### 域名系统 Domain Name System

![DNS](https://raw.githubusercontent.com/ZintrulCre/zintrulcre.github.io/master/data/Computer-Science/DNS.jpg)

- DNS 是一个分布式数据库（每个地址只保留其自己的部分数据），提供了主机名和 IP 地址之间相互转换的服务
- 域名具有层次结构，从上到下分别为根域名，顶级域名，二级域名
- DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53
- DNS 一般使用 UDP 进行传输，域名解析器和域名服务器都必须自己处理超时和重传，从而保证其可靠性
- DNS 在两种情况下会使用 TCP 进行传输
    1. 返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）
    2. 区域传送，即主域名服务器向辅助域名服务器传送变化的部分数据

### 文件传输协议 File Transfer Protocol

- FTP 使用两个 TCP 连接来传输一个文件
    1. 控制连接：服务器打开端口号 21 等待客户端进行连接；客户端主动建立连接后，服务器使用控制连接接收客户端的命令，并传回应答
    2. 数据连接：用来传输文件数据
- 数据连接有 2 种方式
    1. 主动模式：服务器主动建立数据连接，服务器的端口号为 20，客户端的端口号随机（大于1024）
    2. 被动连接：客户端主动建立数据连接，客户端的端口号由客户端指定，服务器端的端口号随机

### 超文本传输协议 Hyper Text Transfer Protocol

- HTTP 主要用于 web 开发
- HTTP 客户端发起一个请求，创建一个到服务器指定端口（默认是 80 端口）的 TCP 连接；HTTP 服务器在对应端口监听客户端的请求，一旦收到请求，服务器会向客户端返回一个状态（例如 "HTTP/1.1 200 OK"）以及相应的内容，如请求的文件，错误消息，或其它信息
- HTTP 是一个无状态的协议，服务器不会去维护与客户端交互的相关信息，因此它对于事务处理没有记忆能力
- HTTP 假定其下层协议提供可靠的传输，因此任何能够提供这种保证的协议都可以被其使用，一般在 TCP/IP 协议族使用 TCP 作为其传输层
- HTTP 可以在任何互联网协议之上，或其他网络上实现
- HTTP 响应
    - 在接收和解释请求消息后，服务器会返回一个 HTTP 响应消息
    - HTTP 响应由三个部分组成，分别是状态行，消息报头，响应正文

### 动态主机配置协议 Dynamic Host Configuration Protocol

![DHCP](https://raw.githubusercontent.com/ZintrulCre/zintrulcre.github.io/master/data/Computer-Science/DHCP.jpg)

- DHCP 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址，子网掩码，网关 IP 地址等
- DHCP 的工作过程
    1. 客户端发送 Discover 报文，其目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，通过 UDP 该报文被广播到同一个子网的所有主机上；如果客户端和 DHCP 服务器不在同一个子网，则需要使用中继代理
    2. DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息；因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择
    3. 客户端选择某个 DHCP 服务器提供的信息，发送 Request 报文给该 DHCP 服务器
    4. DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息

### 地址解析协议 Address Resolution Protocol

- 每个主机会在自己的 ARP 缓冲区建立一个 ARP 列表，以表示 IP 地址和 MAC 地址的对应关系
- 当源主机要发送数据时，首先检查 ARP 列表中是否有对应 IP 地址的目的主机的MAC地址；如果有则直接发送数据；如果没有则向本网段的所有主机发送 ARP 数据包，该数据包包括源主机 IP 地址，源主机 MAC 地址，目的主机 IP 地址
- 当本网络的所有主机收到 ARP 数据包后，检查数据包中的目的主机 IP 地址是否是自己的 IP 地址；如果不是则忽略该数据包；如果是则从数据包中取出源主机的 IP 地址和 MAC 地址并写入到自己的 ARP 列表中；如果已经存在则覆盖；然后将自己的 MAC 地址写入 ARP 响应包中并发送给源主机
- 源主机收到 ARP 响应包后，将目的主机的 IP 和 MAC 地址写入自己的 ARP 列表中，并利用此信息发送数据
- 如果源主机一直没有收到 ARP 响应包，则表示 ARP 查询失败

### Web 请求过程

1. DHCP 配置主机信息
    - 如果主机没有 IP 地址及相应信息，那么需要先使用 DHCP 来获取

2. ARP 解析 MAC 地址

3. DNS 解析域名

4. HTTP 请求页面
